<link href="http://cdn.kendostatic.com/2014.1.416/styles/kendo.common.min.css" rel="stylesheet" />
<link href="http://cdn.kendostatic.com/2014.1.416/styles/kendo.default.min.css" rel="stylesheet" />
<script src="http://cdn.kendostatic.com/2014.1.416/js/kendo.all.min.js"></script>
<script type="text/javascript" src="/assets/messi.js"></script>	
<script type="text/javascript" src="/assets/messi.min.js"></script>	
<%  role = Role.where('id= ?', params[:role_id]).first.title%>
<div id="flash"></div>
<%= active_admin_form_for [:admin, @privilege] , :remote => true do |f| %>
<%#= hidden_field_tag(request_forgery_protection_token.to_s, form_authenticity_token) %>
		 <h2> Assign privilege for : </i><%= role%></i></h2>
		 <%= f.hidden_field :role_id, {:value => params[:role_id]}%>
			<%= f.label :Privilege%>
			<div id="role">
			<div id="previlege" class="previleges roles_0">
			<%= f.select :modular,options_for_select(Section.all.collect{|x| [	x.name, x.id.to_i]}),{include_blank: '-Select Model-' }, {:id => "privilege_modular",  :onChange => "previlege_add(this);"}%>
			<%= f.select :modular_id,options_for_select(Modular.all.collect{}), {:id => "privilege_modular_id", :selected =>"", :class=> "test"}, :multiple => "multiple", disabled: true%>		
    <%= f.submit "ADD" %>	</div>
			</div>
<% end %>
<div id="grid"></div>
<script>
$(document ).ready(function() {
	$('#privilege_modular_id').addClass("multiselect");
	$('.multiselect').multiselect();
});

	 dataSource = new kendo.data.DataSource({
		transport: {
			read: {
				url: '/admin/privileges',
				dataType: 'json'
			},
			destroy: {
				url: function (privilege) {
            		return '/admin/privileges/'+ privilege.id
        		},
				dataType: 'json',
				type: 'DELETE'
			}
		},
		schema: {
	        errors: function(response) {
	         return response.errors;
	      	},
			data: "data",
			model: {
				id: "id",
				fields: {
					id: { type: "string" },
					role_name: { type: "string" },
					model_name: { type: "string" },
					action_name: {type: "string"}
				}
			}
		}
	});
	$(document).ready(function(){
	$("#grid").kendoGrid({
		dataSource: dataSource,
	 	height: 300,
        sortable: true,
        pageable: true,
	 	columns: [
	 		{ field:"role_name", title: "Role"},
	 		{ field:"model_name", title: "Modal"},
	 		{ field:"action_name", title: "Action"},
	 		{ command: ["destroy"], title: "", width: "160px" }
	 	],
	 	editable: "inline"
	});
});

function previlege_add(element)
{
var modal_id = $(element).val();
//~ var selected_div = $($(element).closest('.previleges')).children('#previlege_modular_id');
	$('#privilege_modular_id').attr('disabled', false);
	$("#privilege_modular_id").multiselect('destroy');
	//~ $('.multiselect dropdown-toggle btn btn-default').empty();
		$('#privilege_modular_id option[value]').remove();
	$.ajax({url: "/admin/privileges/modal_previlege", type: 'post', data: {modal_id: modal_id },	success: function(data){
			if(data.actions.length > 0)
				{
				var option="";
				for (var i=0;i<data.actions.length;i++)
				{
				option=option+"<option value="+data.actions[i]["id"]+">"+data.actions[i]["action_name"]+"</option>";
				}
				$('#privilege_modular_id').append(option);
				//~ $('#privilege_modular_id').addClass("multiselect");
				$('.multiselect').multiselect();
				}
				}
});
}


//~ function add_multiple_previlege()
//~ {
//~ var modal_select = "roles_"+$('.previleges').size();
   //~ jQuery("#role").append( "<div class= 'previleges "+modal_select+"'>"+jQuery("#previlege").html()+"</div>");
	 	//~ $($('.'+modal_select).children('#previlege_modular_id')).empty();

     //~ return false;
//~ }

</script>